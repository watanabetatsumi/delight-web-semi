# Requirements Document

## Introduction

この機能は、既存の掲示板アプリケーション（1つ目の課題で作成したCRUD機能）にユーザー認証・認可システムを実装します。Cookieベースの認証を基盤とし、各ユーザーごとにパーソナライズされた掲示板体験を提供します。REST APIを通じてGin（Golang）バックエンドと通信し、SQLiteからMySQLへの移行とGoでのデータベースマイグレーション機能も含みます。将来的にはSessionIDやJWT認証への拡張、ユーザー間チャット機能の追加も可能な設計とします。

## Requirements

### Requirement 1

**User Story:** 開発者として、データベーススキーマを管理できるマイグレーション機能が欲しい。そうすることで、usersテーブルを安全に作成・管理できる。

#### Acceptance Criteria

1. WHEN マイグレーションシステムを初期化する THEN システムはマイグレーション履歴を追跡するテーブルを作成する SHALL
2. WHEN usersテーブルのマイグレーションを実行する THEN システムはusersテーブルを適切なスキーマで作成する SHALL
3. WHEN 既にマイグレーションが適用されている THEN システムは重複実行を防ぐ SHALL
4. WHEN マイグレーションが失敗する THEN システムは適切なエラーメッセージを表示し、ロールバックする SHALL

### Requirement 2

**User Story:** 開発者として、ユーザーがアカウントを作成できるようにしたい。そうすることで、個別のユーザー体験を提供できる。

#### Acceptance Criteria

1. WHEN ユーザーが有効なメールアドレス、ユーザー名、パスワードを入力してアカウント作成APIを呼び出す THEN システムは新しいユーザーアカウントを作成し、成功レスポンスを返す SHALL
2. WHEN ユーザーが既に存在するメールアドレスでアカウント作成を試みる THEN システムは適切なエラーメッセージを返す SHALL
3. WHEN パスワードが最小要件（8文字以上、英数字含む）を満たさない THEN システムはバリデーションエラーを返す SHALL
4. WHEN アカウント作成が成功する THEN システムはパスワードをハッシュ化してデータベースに保存する SHALL

### Requirement 3

**User Story:** ユーザーとして、メールアドレスとパスワードでログインできるようにしたい。そうすることで、自分専用のページにアクセスできる。

#### Acceptance Criteria

1. WHEN ユーザーが有効な認証情報でログインAPIを呼び出す THEN システムは認証Cookieを設定し、ユーザー情報を返す SHALL
2. WHEN ユーザーが無効な認証情報でログインを試みる THEN システムは認証エラーを返し、Cookieを設定しない SHALL
3. WHEN ログインが成功する THEN システムはセッション情報をデータベースに保存する SHALL
4. WHEN 認証Cookieが設定される THEN Cookieは適切なセキュリティ属性（HttpOnly、Secure、SameSite）を持つ SHALL

### Requirement 3

**User Story:** ユーザーとして、ログイン後に自分の投稿のみを表示したり、自分だけが投稿を編集・削除できるようにしたい。そうすることで、パーソナライズされた掲示板体験を得られる。

#### Acceptance Criteria

1. WHEN 認証されたユーザーが投稿作成APIを呼び出す THEN システムはそのユーザーIDと紐づけて投稿を保存する SHALL
2. WHEN ユーザーが自分の投稿一覧を取得する THEN システムはそのユーザーの投稿のみを返す SHALL
3. WHEN ユーザーが掲示板を表示する THEN システムは全ユーザーの投稿を表示するが、各投稿に投稿者名を表示する SHALL
4. WHEN ユーザーが「マイ投稿」ページを表示する THEN システムはそのユーザーの投稿のみをフィルタして表示する SHALL
5. WHEN ユーザーが他人の投稿を編集・削除しようとする THEN システムは403 Forbiddenエラーを返す SHALL
6. WHEN 未認証のユーザーが投稿作成・編集・削除APIにアクセスする THEN システムは401 Unauthorizedエラーを返す SHALL
7. WHEN ユーザーがログアウトAPIを呼び出す THEN システムはCookieを無効化し、セッションを削除する SHALL

### Requirement 4

**User Story:** 開発者として、データベーススキーマを管理できるマイグレーション機能が欲しい。そうすることで、データベース構造を安全に更新できる。

#### Acceptance Criteria

1. WHEN マイグレーションコマンドを実行する THEN システムはusersテーブルを作成する SHALL
2. WHEN マイグレーションを実行する THEN システムはsessionsテーブルを作成する SHALL
3. WHEN 既にマイグレーションが適用されている THEN システムは重複実行を防ぐ SHALL
4. WHEN マイグレーションが失敗する THEN システムは適切なエラーメッセージを表示し、ロールバックする SHALL

### Requirement 5

**User Story:** 開発者として、将来的にSessionIDやJWT認証に拡張できる設計にしたい。そうすることで、認証方式を柔軟に変更できる。

#### Acceptance Criteria

1. WHEN 認証システムを設計する THEN 認証方式を抽象化したインターフェースを提供する SHALL
2. WHEN 新しい認証方式を追加する THEN 既存のコードを大幅に変更せずに実装できる SHALL
3. WHEN 設定で認証方式を切り替える THEN システムは指定された方式で動作する SHALL

### Requirement 6

**User Story:** ユーザーとして、直感的で使いやすいWebインターフェースを通じて認証機能を利用したい。そうすることで、スムーズにアカウント作成、ログイン、投稿管理ができる。

#### Acceptance Criteria

1. WHEN ユーザーがアプリケーションにアクセスする THEN システムは認証状態に応じて適切なページを表示する SHALL
2. WHEN 未認証ユーザーがアクセスする THEN システムはログイン・新規登録フォームを表示する SHALL
3. WHEN ユーザーが新規登録フォームを送信する THEN システムはリアルタイムバリデーションを提供し、成功時は自動ログインする SHALL
4. WHEN ユーザーがログインフォームを送信する THEN システムは認証を行い、成功時はダッシュボードにリダイレクトする SHALL
5. WHEN 認証されたユーザーがアクセスする THEN システムはナビゲーションバーにユーザー情報とログアウトボタンを表示する SHALL
6. WHEN ユーザーがダッシュボードを表示する THEN システムは投稿一覧、マイ投稿、ユーザー一覧を表示する SHALL
7. WHEN ユーザーが投稿を作成・編集・削除する THEN システムは適切な権限チェックとフィードバックを提供する SHALL

### Requirement 7

**User Story:** ユーザーとして、レスポンシブで現代的なUIデザインを体験したい。そうすることで、デスクトップでもモバイルでも快適に利用できる。

#### Acceptance Criteria

1. WHEN ユーザーが異なるデバイスでアクセスする THEN システムは画面サイズに応じて最適化されたレイアウトを表示する SHALL
2. WHEN ユーザーがフォームを操作する THEN システムはリアルタイムバリデーションと視覚的フィードバックを提供する SHALL
3. WHEN ユーザーがボタンやリンクを操作する THEN システムは適切なローディング状態とフィードバックを表示する SHALL
4. WHEN エラーが発生する THEN システムは分かりやすいエラーメッセージとリカバリー手段を提供する SHALL
5. WHEN ユーザーが長時間操作する THEN システムは一貫したデザインシステムと直感的なナビゲーションを提供する SHALL

### Requirement 8

**User Story:** ユーザーとして、将来的にチャット機能を利用できるUIの基盤が欲しい。そうすることで、他のユーザーとのコミュニケーションが可能になる。

#### Acceptance Criteria

1. WHEN ユーザーがダッシュボードを表示する THEN システムはユーザー一覧とオンライン状態を表示する SHALL
2. WHEN ユーザーが他のユーザーをクリックする THEN システムはユーザープロフィールとチャット開始ボタンを表示する SHALL
3. WHEN チャット機能が実装される THEN システムは既存のUIに自然に統合できる設計になっている SHALL
4. WHEN ユーザーがチャット画面を表示する THEN システムはメッセージ履歴、入力フォーム、送信ボタンを表示する SHALL
5. WHEN リアルタイム通信が必要な場合 THEN システムはWebSocketまたはServer-Sent Eventsに対応できる設計になっている SHALL

### Requirement 9 (発展機能)

**User Story:** ユーザーとして、他のユーザーとチャットできる機能が欲しい。そうすることで、掲示板を超えたコミュニケーションを取ることができる。

#### Acceptance Criteria

1. WHEN ユーザーが他のユーザーにメッセージを送信する THEN システムはusers_chatテーブルにメッセージを保存する SHALL
2. WHEN ユーザーがチャット履歴を取得する THEN システムは関連するメッセージを時系列順で返す SHALL
3. WHEN ユーザーが存在しない相手にメッセージを送ろうとする THEN システムはエラーを返す SHALL
4. WHEN チャットメッセージを取得する THEN システムは送信者と受信者の両方がアクセス可能な場合のみデータを返す SHALL
5. WHEN users_chatテーブルを設計する THEN 中間テーブルとして適切な関係性を持つ SHALL